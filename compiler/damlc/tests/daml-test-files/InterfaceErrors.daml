-- Copyright (c) 2022 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.
-- SPDX-License-Identifier: Apache-2.0

-- @SINCE-LF-FEATURE DAML_INTERFACE
module InterfaceErrors where

import Daml.Script

data EmptyInterfaceView = EmptyInterfaceView {}

interface MyInterface where
    viewtype EmptyInterfaceView
    myVirtualChoiceImpl : Update ()
    choice MyVirtualChoice : ()
        controller [] : [Party]
        do
            myVirtualChoiceImpl this

template MyTemplate
    with
        p : Party
    where
        signatory p

-- @ERROR range=26:1-26:17; Attempt to use a contract via an interface that the contract does not implement
fetchBadContract = script do
    p <- allocateParty "Alice"
    p `submit` do
        cid <- createCmd (MyTemplate p)
        let cid' : ContractId MyInterface = coerceContractId cid
        fetch cid'

-- @ERROR range=34:1-34:20; Attempt to use a contract via an interface that the contract does not implement
exerciseBadContract = script do
    p <- allocateParty "Alice"
    p `submit` do
        cid <- createCmd (MyTemplate p)
        let cid' : ContractId MyInterface = coerceContractId cid
        exerciseCmd cid' MyVirtualChoice
