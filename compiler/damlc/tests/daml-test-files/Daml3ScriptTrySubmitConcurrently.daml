-- Copyright (c) 2023 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.
-- SPDX-License-Identifier: Apache-2.0

-- @ SCRIPT-V2

{-# LANGUAGE ApplicativeDo #-}

module Daml3ScriptTrySubmitConcurrently where

import Daml.Script

template T
  with
    p : Party
    t : Text
  where
    signatory p

main : Script ()
main = do
  alice <- allocateParty "alice"
  ress <- alice `trySubmitConcurrently`
    [ createCmd T with
        p = alice
        t = "1"
    , createCmd T with
        p = alice
        t = "2"
    ]
  case ress of
    [Right cid1, Right cid2] -> do
      debug cid1
      debug cid2
      pure ()
    _ -> do
      error $ "unexpected results: " <> show ress
