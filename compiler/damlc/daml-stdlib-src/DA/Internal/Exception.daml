-- Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.
-- SPDX-License-Identifier: Apache-2.0

{-# LANGUAGE CPP #-}
{-# LANGUAGE NoImplicitPrelude #-}

#ifndef DAML_EXCEPTIONS

-- | HIDE
module DA.Internal.Exception where

#else

-- | MOVE DA.Exception This module contains the definitions needed for exception desugaring.
module DA.Internal.Exception
    ( module DA.Internal.Exception
    , AnyException
    , GeneralError
    , ArithmeticError
    , ContractError
    ) where

import GHC.Types
import DA.Internal.LF
import DA.Internal.Prelude ( Optional (..) )

type Exception e =
    ( HasMessage e
    , HasThrow e
    , HasToAnyException e
    , HasFromAnyException e
    )

class HasMessage e where
    message : e -> Text

class HasThrow e where
    throwPure : forall t. e -> t

class HasToAnyException e where
    toAnyException : e -> AnyException

class HasFromAnyException e where
    fromAnyException : AnyException -> Optional e

instance HasMessage AnyException where
    message = primitive @"BEAnyExceptionMessage"
instance HasMessage GeneralError where
    message = primitive @"BEGeneralErrorMessage"
instance HasMessage ArithmeticError where
    message = primitive @"BEArithmeticErrorMessage"
instance HasMessage ContractError where
    message = primitive @"BEContractErrorMessage"

{-
instance HasThrow GeneralError where
    throwPure = magic @"throw"
instance HasThrow ArithmeticError where
    throwPure = magic @"throw"
instance HasThrow ContractError where
    throwPure = magic @"throw"
-}

instance HasToAnyException AnyException where
    toAnyException e = e
{-
instance HasToAnyException GeneralError where
    toAnyException = magic @"toAnyException"
instance HasToAnyException ArithmeticError where
    toAnyException = magic @"toAnyException"
instance HasToAnyException ContractError where
    toAnyException = magic @"toAnyException"
-}

instance HasFromAnyException AnyException where
    fromAnyException = Some
{-
instance HasFromAnyException GeneralError where
    fromAnyException = magic @"fromAnyException"
instance HasFromAnyException ArithmeticError where
    fromAnyException = magic @"fromAnyException"
instance HasFromAnyException ContractError where
    fromAnyException = magic @"fromAnyException"
-}


#endif
