load("//bazel_tools:haskell.bzl", "da_haskell_binary", "da_haskell_library", "da_haskell_test")

da_haskell_library(
    name = "proto3-suite",
    srcs = glob(["src/**/*.hs"]),
    hazel_deps = [
        "aeson",
        "aeson-pretty",
        "attoparsec",
        "base",
        "base64-bytestring",
        "bytestring",
        "containers",
        "deepseq",
        "directory",
        "filepath",
        "foldl",
        "haskell-src",
        "lens",
        "mtl",
        "neat-interpolation",
        "parsec",
        "parsers",
        "pretty",
        "pretty-show",
        "QuickCheck",
        "safe",
        "semigroups",
        "swagger2",
        "system-filepath",
        "text",
        "transformers",
        "turtle",
        "vector",
        "proto3-wire",
    ],
    src_strip_prefix = "src",
    visibility = ["//visibility:public"],
    deps = [
    ],
)

da_haskell_test(
    name = "test",
    srcs = glob([
        "tests/Main.hs",
        "tests/Arb*.hs",
        "tests/Test*.hs",
    ]),
    data = glob(["test-files/*"]),
    hazel_deps = [
        "base",
        "QuickCheck",
        "aeson",
        "attoparsec",
        "directory",
        "base64-bytestring",
        "bytestring",
        "cereal",
        "pretty-show",
        "semigroups",
        "tasty",
        "tasty-hunit",
        "tasty-quickcheck",
        "text",
        "transformers",
        "turtle",
        "vector",
        "proto3-wire",
    ],
    src_strip_prefix = "test",
    visibility = ["//visibility:public"],
    deps = [
        ":proto3-suite",
    ],
)

da_haskell_binary(
    name = "compile-proto-file",
    srcs = glob(["tools/compile-proto-file/*.hs"]),
    hazel_deps = [
        "base",
        "turtle",
        "text",
        "optparse-generic",
        "system-filepath",
    ],
    src_strip_prefix = "tools/compile-proto-file",
    visibility = ["//visibility:public"],
    deps = [
        ":proto3-suite",
    ],
)
