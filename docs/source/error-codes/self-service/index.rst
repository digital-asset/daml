.. Copyright (c) 2021 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.
.. SPDX-License-Identifier: Apache-2.0

Self-Service Error Codes (Experimental)
#######################################

.. toctree::
   :hidden:

.. list-all-error-codes::


Self-Service Error Codes Migration Guide
########################################

The introduction of the self-service error codes means that some of the gRPC error codes returned from service methods change.
Consult the table below for details on those changes.

Note that the table below contains entries only for cases where a gRPC codes was changed.
For example, a service method previously returning gRPC error code ``CODE_A`` may now return 
``CODE_B`` for some error condition while returning ``CODE_A`` for other conditions,
and only an entry for the change from ``CODE_A`` in ``CODE_B`` is included in the table below.


+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|Service method                                 |gRPC error code (legacy errors) |gRPC error code (self-service errors) |Remarks                                                                                                                  |Sef-service error code id                    |
+===============================================+================================+======================================+=========================================================================================================================+=============================================+
|ActiveContractsService.getActiveContracts      |NOT_FOUND                       |OUT_OF_RANGE                          |OUT_OF_RANGE can now be returned when attempting to access the data that has already been pruned.                        |PARTICIPANT_PRUNED_DATA_ACCESSED             |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|CommandCompletionService.completionStream      |NOT_FOUND                       |OUT_OF_RANGE                          |OUT_OF_RANGE can now be returned when attempting to access the data that has already been pruned.                        |PARTICIPANT_PRUNED_DATA_ACCESSED             |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|CommandService.submitAndWait                   |UNAVAILABLE                     |NOT_FOUND                             |NOT_FOUND can now be returned when a ledger configuration was not found.                                                 |LEDGER_CONFIGURATION_NOT_FOUND               |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|CommandService.submitAndWaitForTransaction     |UNAVAILABLE                     |NOT_FOUND                             |NOT_FOUND can now be returned when a ledger configuration was not found.                                                 |LEDGER_CONFIGURATION_NOT_FOUND               |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|CommandService.submitAndWaitForTransactionId   |UNAVAILABLE                     |NOT_FOUND                             |NOT_FOUND can now be returned when a ledger configuration was not found.                                                 |LEDGER_CONFIGURATION_NOT_FOUND               |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|CommandService.submitAndWaitForTransactionTree |UNAVAILABLE                     |NOT_FOUND                             |NOT_FOUND can now be returned when a ledger configuration was not found.                                                 |LEDGER_CONFIGURATION_NOT_FOUND               |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|CommandSubmissionService.submit                |UNAVAILABLE                     |NOT_FOUND                             |NOT_FOUND can now be returned when a ledger configuration was not found.                                                 |LEDGER_CONFIGURATION_NOT_FOUND               |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|ConfigManagementService.setTimeModel           |ABORTED                         |DEADLINE_EXCEEDED                     |DEADLINE_EXCEEDED can now be returned when a time out was reached.                                                       |REQUEST_TIME_OUT                             |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|ConfigManagementService.setTimeModel           |ABORTED                         |FAILED_PRECONDITION                   |FAILED_PRECONDITION can now be returned when a configuration update was rejected.                                        |CONFIGURATION_ENTRY_REJECTED                 |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|ConfigManagementService.setTimeModel           |UNAVAILABLE                     |NOT_FOUND                             |NOT_FOUND can now be returned when a ledger configuration was not found.                                                 |LEDGER_CONFIGURATION_NOT_FOUND               |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|GrpcHealthService.check                        |NOT_FOUND                       |INVALID_ARGUMENT                      |INVALID_ARGUMENT can now be returned when the received request contains invalid values.                                  |INVALID_ARGUMENT                             |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|GrpcHealthService.watch                        |NOT_FOUND                       |INVALID_ARGUMENT                      |INVALID_ARGUMENT can now be returned when the received request contains invalid values.                                  |INVALID_ARGUMENT                             |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|PackageManagementService.uploadDarFile         |ABORTED                         |DEADLINE_EXCEEDED                     |DEADLINE_EXCEEDED can now be returned when a time out was reached.                                                       |REQUEST_TIME_OUT                             |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|PackageManagementService.uploadDarFile         |INVALID_ARGUMENT                |FAILED_PRECONDITION                   |FAILED_PRECONDITION can now be returned when a package upload was rejected.                                              |PACKAGE_UPLOAD_REJECTED                      |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|ParticipantPruningService.prune                |INVALID_ARGUMENT                |OUT_OF_RANGE                          |OUT_OF_RANGE can now be returned when the supplied offset was out of range.                                              |REQUESTED_OFFSET_OUT_OF_RANGE                |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|PartyManagementService.allocateParty           |ABORTED                         |DEADLINE_EXCEEDED                     |DEADLINE_EXCEEDED can now be returned when a time out was reached.                                                       |REQUEST_TIME_OUT                             |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|SubmissionService.submit                       |ABORTED                         |ALREADY_EXISTS                        |ALREADY_EXISTS can now be returned when there was a duplicate contract key during interpretation.                        |DUPLICATE_CONTRACT_KEY_DURING_INTERPRETATION |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|SubmissionService.submit                       |ABORTED                         |INTERNAL                              |INTERNAL can now be returned when validation fails on replay mismatch.                                                   |LEDGER_API_INTERNAL_ERROR                    |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|SubmissionService.submit                       |ABORTED                         |NOT_FOUND                             |NOT_FOUND can now be returned when contract key was not found during interpretation.                                     |CONTRACT_NOT_FOUND                           |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|SubmissionService.submit                       |INVALID_ARGUMENT                |FAILED_PRECONDITION                   |FAILED_PRECONDITION can now be returned when a Daml transaction fails during interpretation.                             |DAML_INTERPRETATION_ERROR                    |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|SubmissionService.submit                       |INVALID_ARGUMENT                |INTERNAL                              |INTERNAL can now be returned in case of internal errors.                                                                 |LEDGER_API_INTERNAL_ERROR                    |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|SubmissionService.submit                       |INVALID_ARGUMENT                |NOT_FOUND                             |NOT_FOUND can now be returned when a Daml interpreter can not resolve a contract key to an active contract.              |CONTRACT_KEY_NOT_FOUND                       |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|SubmissionService.submit                       |INVALID_ARGUMENT                |NOT_FOUND                             |NOT_FOUND can now be returned when a Daml transaction was referring to a package which was not known to the participant. |MISSING_PACKAGE                              |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|SubmissionService.submit                       |INVALID_ARGUMENT                |NOT_FOUND                             |NOT_FOUND can now be returned when an exercise or fetch happens on a transaction-locally consumed contract.              |CONTRACT_NOT_ACTIVE                          |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|SubmissionService.submit                       |INVALID_ARGUMENT                |UNKNOWN                               |UNKNOWN can now be returned when package validation fails.                                                               |PACKAGE_VALIDATION_FAILED                    |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|SubmissionService.submit                       |UNAVAILABLE                     |NOT_FOUND                             |NOT_FOUND can now be returned when a ledger configuration was not found.                                                 |LEDGER_CONFIGURATION_NOT_FOUND               |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|TransactionService.getFlatTransactionByEventId |NOT_FOUND                       |INVALID_ARGUMENT                      |INVALID_ARGUMENT can now be returned when the received request contains invalid values.                                  |INVALID_ARGUMENT                             |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|TransactionService.getTransactionByEventId     |NOT_FOUND                       |INVALID_ARGUMENT                      |INVALID_ARGUMENT can now be returned when the received request contains invalid values.                                  |INVALID_ARGUMENT                             |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|TransactionService.getTransactionTrees         |INVALID_ARGUMENT                |OUT_OF_RANGE                          |OUT_OF_RANGE can now be returned when the supplied offset was out of range.                                              |REQUESTED_OFFSET_OUT_OF_RANGE                |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|TransactionService.getTransactionTrees         |NOT_FOUND                       |OUT_OF_RANGE                          |OUT_OF_RANGE can now be returned when attempting to access the data that has already been pruned.                        |PARTICIPANT_PRUNED_DATA_ACCESSED             |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|TransactionService.getTransactions             |INVALID_ARGUMENT                |OUT_OF_RANGE                          |OUT_OF_RANGE can now be returned when the supplied offset was out of range.                                              |REQUESTED_OFFSET_OUT_OF_RANGE                |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
|TransactionService.getTransactions             |NOT_FOUND                       |OUT_OF_RANGE                          |OUT_OF_RANGE can now be returned when attempting to access the data that has already been pruned.                        |PARTICIPANT_PRUNED_DATA_ACCESSED             |
+-----------------------------------------------+--------------------------------+--------------------------------------+-------------------------------------------------------------------------------------------------------------------------+---------------------------------------------+
