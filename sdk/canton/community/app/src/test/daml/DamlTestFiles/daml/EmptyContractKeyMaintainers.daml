-- Copyright (c) 2026 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.
-- SPDX-License-Identifier: Apache-2.0

-- @ERROR range=44:1-44:22; Attempt to create a contract key with an empty set of maintainers
-- @TO DO queryContractKey loses errors, ideally below is: Attempt to fetch, lookup or exercise a contract key with an empty set of maintainers
-- @ERROR range=48:1-48:18; Couldn't see contract with key 'Alice'
-- @ERROR range=52:1-52:19; Attempt to create a contract key with an empty set of maintainers
-- @ERROR range=56:1-56:18; Attempt to fetch, lookup or exercise a contract key with an empty set of maintainers
-- @ERROR range=60:1-60:19; Attempt to fetch, lookup or exercise a contract key with an empty set of maintainers
module EmptyContractKeyMaintainers where

import Daml.Script

template NoMaintainer
  with
    sig: Party
  where
    signatory sig
    key sig : Party
    maintainer [] @Party

-- Helper template to call `fetchByKey` and `lookupByKey`.
template Helper
  with
    p : Party
  where
    signatory p
    choice FetchByKey : (ContractId NoMaintainer, NoMaintainer)
      with
        akey : Party
      controller p
      do fetchByKey @NoMaintainer akey

    choice LookupByKey : Optional (ContractId NoMaintainer)
        with 
            akey : Party
        controller p
        do lookupByKey @NoMaintainer akey

createNoMaintainer : Script ()
createNoMaintainer = do 
  alice <- allocateParty "Alice"

  submitMustFail alice do createCmd NoMaintainer with sig = alice
  pure ()


lookupNoMaintainer : Script ()
lookupNoMaintainer = do 
  alice <- allocateParty "Alice"
  submitMustFail alice do createAndExerciseCmd (Helper alice) (LookupByKey alice)
  pure ()

fetchNoMaintainer : Script ()
fetchNoMaintainer = do 
  alice <- allocateParty "Alice"

  submitMustFail alice do createAndExerciseCmd (Helper alice) (FetchByKey alice)
  pure ()

queryNoMaintainer : Script ()
queryNoMaintainer = do 
  alice <- allocateParty "Alice"

  queryContractKey @NoMaintainer alice alice
  pure ()
