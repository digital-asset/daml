-- Copyright (c) 2025 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.
-- SPDX-License-Identifier: Apache-2.0

module ConsumedContractKey where

import Daml.Script

template Foo
  with
    signer: Party
  where
    signatory signer
    key signer : Party
    maintainer key
    choice FetchKey : Foo
      controller signer
      do
        snd <$> fetchByKey @Foo signer
    choice LookupKey : ()
      controller signer
      do
        None <- lookupByKey @Foo signer
        pure ()
    choice Fetch : Foo
      controller signer
      do fetch self

testFetchKeyFromConsumingChoice = script do
  alice <- allocateParty "Alice"
  fooId <- alice `submit` createCmd Foo with signer = alice
  alice `submitMustFail` exerciseCmd fooId FetchKey

testLookupKeyFromConsumingChoice = script do
  alice <- allocateParty "Alice"
  fooId <- alice `submit` createCmd Foo with signer = alice
  alice `submit` exerciseCmd fooId LookupKey

testFetchFromConsumingChoice = script do
  alice <- allocateParty "Alice"
  fooId <- alice `submit` createCmd Foo with signer = alice
  alice `submitMustFail` exerciseCmd fooId Fetch