-- Copyright (c) 2026 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.
-- SPDX-License-Identifier: Apache-2.0

module SubViewsMain where

import SubViewsInterface
import qualified V1.SubViewsAsset as V1
import qualified V2.SubViewsAsset as V2

template Top
  with
    party : Party
  where
    signatory party

    nonconsuming choice MkTransaction : ContractId V2.Asset
      with
        top1 : ContractId I1
        top2 : ContractId I2
        factoryId1 : ContractId V1.AssetFactory
        factoryId2 : ContractId V2.AssetFactory
      controller party
        do cid <- exercise top1 (I1Choice party factoryId1)
           exercise top2 (I2Choice party (coerceContractId @V1.Asset @V2.Asset cid) factoryId2)

template Top1
  with
    sig : Party
    obs : Party
  where
    signatory sig
    observer obs

    interface instance I1 for Top1 where
      view = I1View
      i1Choice factoryId = exercise factoryId (V1.CreateAsset sig)

template Top2
  with
    sig : Party
    obs : Party
  where
    signatory sig
    observer obs

    interface instance I2 for Top2 where
      view = I2View
      i2Choice cid factoryId = exercise cid (V2.Cycle sig factoryId)
