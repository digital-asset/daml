-- Copyright (c) 2020, Digital Asset (Switzerland) GmbH and/or its affiliates.
-- All rights reserved.

-- @SINCE-LF 2.dev

{-# OPTIONS_GHC -Wno-x-crypto #-}

module AttestationTests where

import AttestationTestData
import DA.Assert ((===))
import DA.Crypto.Text
import DA.Foldable (forA_)
import Daml.Script

template ValidateTestMessageSignature with
    signature : SignatureHex
    publicKey : PublicKeyHex
    messageHash : BytesHex
    owner : Party
  where
    signatory owner
    ensure secp256k1 signature messageHash publicKey

main =
  script do
    forA_ testData \test -> do
      ((serializeTestMessage test.message) === test.encodedMessage)
      ((keccak256 (serializeTestMessage test.message)) === test.messageHash)
      actualSig <- secp256k1signWithEcdsaOnly signerPrivateKey test.messageHash
      (actualSig === test.signature)
      --alice <- allocateParty "Alice"
      --submit alice do
      --  createCmd ValidateTestMessageSignature with
      --    publicKey = signerPublicKey
      --    messageHash = test.messageHash
      --    signature = test.signature
      --    owner = alice
    pure ()
