-- Copyright (c) 2020, Digital Asset (Switzerland) GmbH and/or its affiliates.
-- All rights reserved.

module NullChar where

import Daml.Script
import DA.Text (fromCodePoints)

template T
  with
    p : Party
    t : Text
  where
    signatory p

template Helper
  with
    p : Party
  where
    signatory p
    choice CreateTWithNullChar: ContractId T
      controller p
      do create T with p = p; t = fromCodePoints [0]

-- @ERROR range=26:1-26:11; Text contains null character
testLedger = script do
  alice <- allocateParty "Alice"
  alice `submit` createAndExerciseCmd (Helper alice) CreateTWithNullChar

-- TODO it seems that when SValue#toValue throws the test crashed ans freezes
-- remove the function argument, once this is fixed
testScript _ = script do
  pure $ fromCodePoints [0]