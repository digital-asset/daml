akka {
    stream {
        materializer {
            subscription-timeout {
                # We increase it (default is 5s) in order to allow early materialization of the bridge.
                timeout = 60s
            }
        }
    }
}

ledger {
    engine {
        allowed-language-versions = early-access
        contract-key-uniqueness = on
        forbid-v-0-contract-id = true
        limits {
            choice-controllers = 2147483647
            choice-observers = 2147483647
            contract-observers = 2147483647
            contract-signatories = 2147483647
            transaction-input-contracts = 2147483647
        }
        package-validation = true
        require-suffixed-global-contract-id = false
        stack-trace-mode = false
    }
    ledger-id = default-ledger-id
    metrics {
        reporting-interval = "10s"
    }
    data-source {
        default {
            jdbc-url = "jdbc:h2:mem:default;db_close_delay=-1;db_close_on_exit=false"
            jdbc-url = ${?DEFAULT_PARTICIPANT_DATABASE_JDBC_URL}
        }
    }
    participants {
        default {
            api-server {
                authentication {
                    type = wildcard
                }
                command {
                    input-buffer-size = 512
                    max-commands-in-flight = 256
                    tracker-retention-period = "300 seconds"
                }
                configuration-load-timeout = "10s"
                initial-ledger-configuration {
                    avg-transaction-latency = "0 days"
                    delay-before-submitting = "0 days"
                    max-deduplication-duration = "1800 seconds"
                    max-skew = "30 seconds"
                    min-skew = "30 seconds"
                }
                management-service-timeout = "2m"
                max-inbound-message-size = 67108864
                party {
                    implicit-party-allocation = false
                }
                port = 6865
                seeding = strong
                time-provider-type = wall-clock
                user-management {
                    cache-expiry-after-write-in-seconds = 5
                    enabled = false
                    max-cache-size = 100
                    max-users-page-size = 1000
                }
                api-stream-shutdown-timeout = "5 seconds"
            }
            data-source-properties {
                connection-pool {
                    connection-timeout = "250ms"
                    connection-pool-size = 16
                }
                postgres {}
            }
            index-service {
                acs-contract-fetching-parallelism = 2
                acs-global-parallelism = 10
                acs-id-fetching-parallelism = 2
                acs-id-page-size = 20000
                archive-files = []
                enable-in-memory-fan-out-for-ledger-api = false
                events-page-size = 1000
                events-processing-parallelism = 8
                max-contract-key-state-cache-size = 100000
                max-contract-state-cache-size = 100000
                max-transactions-in-memory-fan-out-buffer-size = 10000
                api-stream-shutdown-timeout = "5 seconds"
            }
            indexer {
                batch-within-millis = 50
                batching-parallelism = 4
                enable-compression = false
                high-availability {
                    indexer-lock-id = 105305792
                    indexer-lock-id = ${?INDEXER_HIGH_AVAILABILITY_LOCK_ID}
                    indexer-worker-lock-id = 105305793
                    indexer-worker-lock-id = ${?INDEXER_HIGH_AVAILABILITY_WORKER_LOCK_ID}
                    main-lock-acquire-retry-millis = 500
                    main-lock-checker-period-millis = 1000
                    worker-lock-acquire-max-retry = 1000
                    worker-lock-acquire-retry-millis = 500
                }
                ingestion-parallelism = 16
                input-mapping-parallelism = 16
                max-input-buffer-size = 50
                restart-delay = "10s"
                startup-mode {
                    allow-existing-schema = false
                    type = migrate-and-start
                }
                submission-batch-size = 50
                tailing-rate-limit-per-second = 20
            }
            lf-value-translation-cache {
                contracts-maximum-size = 0
                events-maximum-size = 0
            }
            mode = combined
        }
    }
}

bridge {
    conflict-checking-enabled = true
    submission-buffer-size = 500
    max-deduplication-duration = "1800 seconds"
}
