-- Copyright (c) 2023 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.
-- SPDX-License-Identifier: Apache-2.0

module IO where

toBeReplaced = error "not implemented"

data Token = Token

newtype IO a = IO (Token -> a)

run (IO f) = f Token

instance Functor IO where
    fmap f x = x >>= \v -> pure (f v)

instance Applicative IO where
    pure x = IO (\_ -> x)
    f <*> x = f >>= \f -> x >>= \x -> pure (f x)

instance Action IO where
  m >>= n = n $ run m

pop_ : Token -> Int
pop_ = toBeReplaced

pop : IO Int
pop = IO pop_

log_ : Text -> ()
log_ = toBeReplaced

log: Text -> IO ()
log t = IO (\_ -> log_ t)

test: IO ()
test = do
  _ <- log $ ">"
  i <- pop
  j <- pop
  _ <- log $ show j
  _ <- log "."
  _ <- log $ show i
  _ <- log "<"
  pure ()


